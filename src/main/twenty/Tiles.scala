package twenty

import three.Coord

object Tiles extends App {

  def findCorners(input: String): BigInt = {
    val tiles = input.split("\n\n").map(parseTile)
    val corners = tiles.filter(tile => matchesTwo(tiles, tile))
    corners.map(_.id).product
  }

  def findSeaMonsters(input: String): Int = {
    val tiles = input.split("\n\n").map(parseTile)
    val corners = tiles.filter(tile => matchesTwo(tiles, tile))
    val map: Map[Coord, Tile] = getMapOfTiles(Coord(0, 0), findNeighbours(tiles, corners(0)), tiles, Map(Coord(0, 0) -> corners(0)))
    val concatenated = concatToTile(map)
    var i = 0
    var next = findSeaMonster(concatenated)
    while (!next.tile.mkString.contains('O')) {
      if (i % 4 != 0 || i == 0) {
        next = next.rotate()
      } else {
        next = next.flip()
      }
      next = findSeaMonster(next)
      i += 1
    }
    next.tile.mkString.count(_ == '#')
  }

  def findSeaMonster(tile: Tile): Tile = {
    val newArray = tile.tile
    for (j <- 0 until tile.tile.length - 3) {
      for (i <- 0 until tile.tile(0).length - 20) {
        if (tile.tile(j)(i + 18) == '#' && tile.tile(j + 1)(i) == '#' && tile.tile(j + 1)(i + 5) == '#' && tile.tile(j + 1)(i + 6) == '#'
          && tile.tile(j + 1)(i + 11) == '#' && tile.tile(j + 1)(i + 12) == '#' && tile.tile(j + 1)(i + 17) == '#' && tile.tile(j + 1)(i + 18) == '#'
          && tile.tile(j + 1)(i + 19) == '#' && tile.tile(j + 2)(i + 1) == '#' && tile.tile(j + 2)(i + 4) == '#' && tile.tile(j + 2)(i + 7) == '#'
          && tile.tile(j + 2)(i + 10) == '#' && tile.tile(j + 2)(i + 13) == '#' && tile.tile(j + 2)(i + 16) == '#') {
          newArray(j) = replaceChar(tile.tile(j), i + 18)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 5)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 6)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 11)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 12)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 17)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 18)
          newArray(j + 1) = replaceChar(tile.tile(j + 1), i + 19)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 1)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 4)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 7)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 10)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 13)
          newArray(j + 2) = replaceChar(tile.tile(j + 2), i + 16)
        }
      }
    }
    Tile(0, newArray)
  }

  private def replaceChar(string: String, index: Int): String = {
    val sb = new StringBuilder(string)
    sb.setCharAt(index, 'O')
    sb.toString()
  }

  private def concatToTile(map: Map[Coord, Tile]): Tile = {
    val minX = map.keySet.map(_.x).min
    val minY = map.keySet.map(_.y).min
    val maxX = map.keySet.map(_.x).max
    val maxY = map.keySet.map(_.y).max

    var tile = Tile(0, Array())
    for (j <- minY to maxY by 1) {
      var rowTile = Tile(0, map(Coord(0, j)).removeBorders().tile.map(s => ""))
      for (i <- minX to maxX by 1) {
        rowTile = rowTile.concatRow(map(Coord(i, j)).removeBorders())
      }
      tile = tile.concatColumn(rowTile)
    }
    tile
  }

  private def getMapOfTiles(current: Coord, next: Array[(String, Tile)], tiles: Array[Tile], map: Map[Coord, Tile]): Map[Coord, Tile] = {
    var newMap = map
    val alreadyFoundIds = newMap.values.map(_.id).toSet
    val notFoundYet = next
      .filter(n => !alreadyFoundIds.contains(n._2.id))
    notFoundYet.foreach(n => {
      newMap = newMap + (current.get(n._1) -> rotateCorrectly(newMap(current), n._1, n._2))
    })
    if (notFoundYet.isEmpty) {
      return newMap
    }
    notFoundYet.flatMap(n => {
      getMapOfTiles(current.get(n._1), findNeighbours(tiles, rotateCorrectly(newMap(current), n._1, n._2)), tiles, newMap).toSeq
    }).toMap
  }

  def rotateCorrectly(current: Tile, direction: String, toBeRotated: Tile): Tile = {
    val border = direction match {
      case "S" => current.south()
      case "N" => current.north()
      case "E" => current.east()
      case "W" => current.west()
    }
    var rotated = toBeRotated
    var oppositeBorder: String = getOppositeBorder(direction, rotated)
    var i = 0
    while (oppositeBorder != border) {
      if (i % 4 != 0 || i == 0) {
        rotated = rotated.rotate()
      } else {
        rotated = rotated.flip()
      }
      i += 1
      oppositeBorder = getOppositeBorder(direction, rotated)
      if (i > 8) {
        return null
      }
    }
    rotated
  }

  private def getOppositeBorder(direction: String, tile: Tile): String = {
    direction match {
      case "S" => tile.north()
      case "N" => tile.south()
      case "E" => tile.west()
      case "W" => tile.east()
    }
  }

  def getNeighbourDirection(neighbour: Tile, current: Tile): String = {
    val allBorders = neighbour.allBorders()
    if (allBorders.contains(current.south())) {
      return "S"
    }
    if (allBorders.contains(current.north())) {
      return "N"
    }
    if (allBorders.contains(current.east())) {
      return "E"
    }
    if (allBorders.contains(current.west())) {
      return "W"
    }
    "0"
  }

  private def findNeighbours(tiles: Array[Tile], tile: Tile): Array[(String, Tile)] = {
    val possibleBorders = tile.allBorders().diff(getNotMatchingBorders(tiles, tile))
    val removed = tiles.filter(_ != tile)
    val neighbours = removed.filter(t => t.allBorders().intersect(possibleBorders).nonEmpty)
    println(neighbours.map(_.id).mkString("Array(", ", ", ")"))
    neighbours.map(n => (getNeighbourDirection(n, tile), n))
  }

  private def matchesTwo(tiles: Array[Tile], tile: Tile): Boolean = {
    getNotMatchingBorders(tiles, tile).size == 4
  }

  private def getNotMatchingBorders(tiles: Array[Tile], tile: Tile) = {
    val removed = tiles.filter(_ != tile)
    val allBorders = removed.flatMap(_.allBorders()).toSet
    tile.allBorders().diff(allBorders)
  }

  def parseTile(input: String): Tile = {
    val split = input.split("\n")
    val id = split(0).substring(5, 9).toInt
    val tile = split.slice(1, split.length)
    Tile(id, tile)
  }

  val input = "Tile 2053:\n......#.#.\n#....#....\n#.#.......\n.##.#..#.#\n.##...####\n#.#....#.#\n##.##.#.#.\n...##.....\n####.##..#\n#..##...##\n\nTile 1543:\n.####.##..\n.......#.#\n..........\n..#.......\n#......#..\n#....##...\n#.#....#..\n#..##....#\n#.#..#....\n#.#...####\n\nTile 2441:\n.##.#..##.\n#..#......\n..#...#.##\n...#.....#\n#..##.....\n......##..\n###.#....#\n##...#.#..\n...#...###\n.#..#.##.#\n\nTile 3733:\n..#..#....\n..#.#.....\n......#.##\n.#..#.##.#\n..#....#..\n......#..#\n.###.#....\n.#.#..#..#\n.#....#...\n#..#..##..\n\nTile 2237:\n###.....#.\n#..#.....#\n........#.\n#.#.......\n#........#\n##...#...#\n..#.......\n#.......##\n##..#....#\n...###...#\n\nTile 2203:\n##..#....#\n.....##...\n...#....##\n.........#\n##....#..#\n#.#..#.#..\n.......###\n.#....#..#\n......###.\n...#..#.##\n\nTile 1783:\n#...##..#.\n........#.\n#..#.###.#\n....#.##..\n....#....#\n..#.#....#\n.........#\n##.#.....#\n#.#.....##\n#....#..#.\n\nTile 1487:\n#.....#...\n#..#.#...#\n..........\n.........#\n#.....##.#\n....###.##\n##...#...#\n##......##\n........#.\n....#####.\n\nTile 3209:\n...#....##\n#...##..#.\n..#.....##\n#.##...###\n...#..##.#\n..#..#....\n......#.#.\n..........\n.##...##.#\n#..##.####\n\nTile 2557:\n#......#.#\n...#......\n##.###.#..\n.###....##\n#.........\n....#.#...\n.#..###..#\n...#...##.\n.#.....#.#\n.###.##.#.\n\nTile 1009:\n###.##....\n###.#..#.#\n#.#....#..\n.....##.##\n...#.#....\n..#.##.#..\n#..##.#.##\n#..#......\n#..#...#.#\n#..#.#..##\n\nTile 1361:\n#..#..###.\n....#...#.\n##.#....##\n......#..#\n.........#\n##..##...#\n#...##...#\n#...#.....\n..##....##\n#..#..####\n\nTile 2767:\n.#.###.###\n#.#.......\n...#...##.\n#..#...#..\n#.#...#...\n.#........\n##....#...\n#....#.#..\n#.......#.\n#.#.#..#..\n\nTile 1109:\n.#..#..#.#\n.....#..#.\n......#..#\n..##...#..\n...#.#..##\n...#.#..##\n......##..\n#...#..#..\n#...#.....\n..#.#.#.#.\n\nTile 1493:\n###..####.\n....##...#\n#..#.#....\n##.....#..\n#..#.#..#.\n#.........\n#...#.#.#.\n#.#..#.#.#\n##.....#.#\n#.#.#.###.\n\nTile 2971:\n#####...#.\n....#.....\n#.......##\n..#.#...##\n...#.##..#\n###.#..###\n#......#.#\n..........\n...#..#...\n.....#..##\n\nTile 2909:\n.######.##\n###..#...#\n#....###..\n#.####...#\n..#.##....\n#.........\n..#.#....#\n.#.##.##..\n##.###.#.#\n...##..#..\n\nTile 2551:\n.#.##.#.#.\n###.#..##.\n#.......#.\n##.......#\n..###.....\n#.##..#...\n#.##....#.\n#......#.#\n......#.##\n#.#...#..#\n\nTile 2917:\n..###.##..\n..#...#..#\n#........#\n#....##.##\n#.........\n...##.....\n.###...##.\n#.#...##..\n.#.#.#.##.\n.#.#..####\n\nTile 1553:\n..##..#..#\n#..#...#.#\n#.#....#.#\n##........\n.###...#..\n#.##.##.##\n.....#..#.\n#.....##..\n.......#.#\n##.#.#.##.\n\nTile 2297:\n.##.##.#..\n.##.#..##.\n...#.#.###\n...##...##\n.#..##..##\n##.#......\n...#.....#\n#.#.#...#.\n.#......##\n....#.##.#\n\nTile 1789:\n####....#.\n#.#.#..#..\n...##.####\n##.#.#...#\n.###.....#\n.#.#...##.\n#...##.#..\n##...#...#\n..#.......\n#######...\n\nTile 3079:\n#.##..#.#.\n#........#\n..#..#....\n..#..###.#\n.......#.#\n#....#####\n#......##.\n#..##.#...\n#.......#.\n###..##.##\n\nTile 3037:\n..####.###\n....##.#..\n.......##.\n....#...#.\n..#.#.....\n.#......##\n##....##..\n#..#.#.#..\n##......##\n###..###..\n\nTile 2677:\n##.#..#...\n.#........\n..###..#.#\n..##.....#\n.##....#.#\n#.#...#..#\n......#.##\n.......#.#\n..........\n#.#.#..###\n\nTile 1129:\n.##.#.#.##\n.........#\n#.##.#....\n.#...##..#\n.#...#...#\n..#..#.#..\n##..#....#\n##........\n..#.##.###\n##..#.####\n\nTile 2647:\n.......#..\n#........#\n.....#.#..\n.......##.\n##..#.....\n.#.###..#.\n#....#.##.\n#.#....#..\n#.#..#...#\n..##.###.#\n\nTile 2531:\n#.#.##..##\n##..#...#.\n..#.......\n##.......#\n..........\n.....#...#\n#..###...#\n#........#\n#.........\n.####..##.\n\nTile 1663:\n.#.#..#...\n..#...#...\n##...##.#.\n...#...#..\n.##....#..\n#........#\n...#...#..\n##....#..#\n#.....#...\n.####.##..\n\nTile 1193:\n#......##.\n..#.#.###.\n#..#.....#\n#.##.....#\n.....#..##\n....#.#..#\n#..#.....#\n..........\n...###....\n#..#.#.###\n\nTile 2477:\n.#...#.##.\n#....##..#\n#.##.#...#\n##..#.....\n.........#\n..#..#...#\n.##...#.##\n#.###.....\n#..##.....\n..#.##.#.#\n\nTile 2083:\n.#.#.#.#..\n###.#.....\n.....#..##\n...#.#....\n#.......#.\n.#.###....\n#.#.#.....\n.##..#.#.#\n#.##.....#\n..##.#.##.\n\nTile 2897:\n###.####..\n..##....##\n###...#...\n.......#..\n#..#.#..#.\n.....###..\n......##..\n....##..#.\n.#...##..#\n#.....#..#\n\nTile 3797:\n#.....#...\n..#.####.#\n#....#.#..\n#.....#.##\n##..#.....\n#....#..##\n...#...#.#\n.#....####\n##.##.###.\n###.#.#...\n\nTile 2087:\n#####....#\n..##...##.\n...#......\n.##......#\n#..#....#.\n.#..#....#\n..##......\n#........#\n#.......#.\n#.#.##...#\n\nTile 2447:\n#.##....#.\n##........\n##........\n#.#...#..#\n##.#...#..\n#..#..##.#\n#........#\n........#.\n#...#....#\n#.....#.##\n\nTile 1511:\n#...#####.\n..#.......\n.........#\n..#......#\n###.......\n.....#..##\n#..#.....#\n#.##.#....\n......#..#\n###.#.#.##\n\nTile 1249:\n#.#..##...\n#...#.#.#.\n......#..#\n#....##...\n....#.##..\n.#..##...#\n#....###..\n#....#....\n.....#...#\n...###.##.\n\nTile 2741:\n###..#..#.\n#.##.#...#\n#...#....#\n.....#...#\n#.....#.#.\n#.##.#...#\n#.#..#...#\n......#.#.\n#...#..#..\n..####.#..\n\nTile 3607:\n#.#####..#\n#..#.#.#.#\n.......##.\n#........#\n#.#..#....\n#..##.####\n...#..#.#.\n........##\n..#...#.#.\n...#..#..#\n\nTile 3877:\n###..##...\n##...#....\n#.........\n........##\n#....#...#\n#...#....#\n.....#....\n...#...#.#\n#..#.#...#\n.##...###.\n\nTile 1277:\n..#....#.#\n####..#...\n#.........\n..........\n#...#..##.\n...#.#...#\n#........#\n....#.....\n...#..#..#\n##.#....##\n\nTile 3491:\n..#...##..\n.........#\n#.........\n...#......\n...#..#.##\n#...##....\n#....#.#..\n#....##...\n..#.#..#.#\n#.#.#.#.#.\n\nTile 2011:\n..##...##.\n....#.#..#\n#..#....##\n..........\n..........\n.....#...#\n#..#.#...#\n........##\n.#.......#\n##.......#\n\nTile 1087:\n#.#.#.#.#.\n..#..#..##\n#.###.....\n#...#..#.#\n#....#...#\n#....#...#\n..##..#.##\n#...##....\n##........\n#......##.\n\nTile 3307:\n#..##..#.#\n...#######\n#......###\n..#......#\n#....##..#\n.#.#.#...#\n#........#\n#.......##\n..#..#...#\n#.#..##.#.\n\nTile 1949:\n#.###..##.\n#.#......#\n#....#.##.\n##......#.\n#.......##\n#.##.#...#\n.##....#..\n..........\n...###....\n..#..##..#\n\nTile 1061:\n...#..#..#\n#.....#..#\n##.#....##\n.#....#..#\n..........\n#.......##\n.#.#.....#\n..........\n#.#...#.#.\n........#.\n\nTile 1429:\n##.#####..\n.#........\n#....#....\n...#......\n#........#\n##.....#.#\n....##.#..\n....#..##.\n#...#....#\n###.#.##.#\n\nTile 2221:\n###.#.....\n#.......#.\n....##.#.#\n........##\n..#..#....\n..###....#\n#........#\n##.#.#....\n#...#...##\n##.######.\n\nTile 1117:\n..#.##.#.#\n##.......#\n..#.#.....\n.##......#\n.##..#....\n.........#\n..#.......\n##.#.#.#.#\n#.#.......\n#.#..#...#\n\nTile 1571:\n..##.##..#\n...#...#.#\n#.##......\n#..#......\n..#..#...#\n#.......##\n...##....#\n..#.#....#\n#.#..#..##\n.##..#.#..\n\nTile 2969:\n.##..#..#.\n..........\n#......#..\n#...#....#\n..........\n..##.#.###\n.....#....\n.......#.#\n####..#.#.\n..##..#...\n\nTile 2713:\n####.##.#.\n#.##.#.#..\n#...##....\n#......#..\n#.##.#....\n#.........\n..##...#.#\n#...#.#.#.\n#.......##\n..####..##\n\nTile 3121:\n....#.##..\n..#......#\n..#..##...\n#.#......#\n#....#..##\n....##...#\n#..#.#....\n#.....#..#\n..#...#.#.\n.#..####.#\n\nTile 3673:\n.#.##..###\n..#.#.....\n...#..#..#\n..........\n.##....###\n#..#...#..\n#..##..#..\n#...#.....\n##.#..#..#\n....##.###\n\nTile 2683:\n..#...#.##\n..#..##.##\n###..#....\n###..#..##\n.......#..\n..##.....#\n#.....#..#\n#.###.#.#.\n#.#.#.###.\n..#.#...#.\n\nTile 2617:\n.#...#....\n.......###\n.##..#....\n..#..###.#\n#..##..#.#\n#.#.###..#\n..#..###.#\n.#....#..#\n##....#.##\n..#.#..###\n\nTile 2341:\n......###.\n..#..#....\n..#.#...#.\n..#.#.###.\n...##.#..#\n##......#.\n.........#\n#..#...#..\n#.......##\n###...#...\n\nTile 1609:\n..##.#.#..\n#.......##\n#......#.#\n#.......#.\n..##...#..\n...#.#....\n##......#.\n.###...#..\n.#....#..#\n....#####.\n\nTile 3299:\n#####.####\n.##.....#.\n..#...#...\n...#....#.\n#..#.#...#\n#...#...##\n#.....##.#\n....#.##..\n##....#...\n.##..##.#.\n\nTile 1259:\n##.#......\n........#.\n.....#.###\n....#.#.##\n#.....#.##\n..#....#.#\n..........\n.##.##...#\n....##..#.\n...#...#..\n\nTile 2803:\n.#..#.#..#\n#...###..#\n..###.####\n#....#.#.#\n##.......#\n#.#.#.#...\n.#.#.#.#.#\n#....#....\n....#....#\n...###..#.\n\nTile 1063:\n.#.##.##.#\n......#.##\n.#..#.##..\n#....###..\n....###...\n.##....#.#\n#.#.#....#\n.....#..#.\n##......##\n.######..#\n\nTile 2113:\n..#.######\n####.....#\n#.#....##.\n........##\n#.#.....##\n...#.....#\n#.........\n#.....#..#\n##.##.#.##\n.##.###.##\n\nTile 1531:\n.###..#.##\n#.....##.#\n.......#.#\n........##\n#.....#...\n#.#.#...#.\n..#...#..#\n##.##.##..\n..........\n#...#...##\n\nTile 1289:\n##.###.###\n....#..#..\n####....##\n#.#....#..\n#.........\n#.#....#.#\n...#......\n.##.......\n##..#.....\n...##.####\n\nTile 3529:\n###..#.#.#\n#..###....\n....#...##\n.#....###.\n##...#....\n#.##.#.#..\n####..#.#.\n#....#....\n#.##.##..#\n#.##.#....\n\nTile 2389:\n.##.##.#..\n#.###...##\n..##....##\n#.###.#...\n#.#......#\n.#......##\n##..#.#..#\n#..#......\n..###.....\n#.#####..#\n\nTile 3727:\n#.#.##..#.\n##.###.###\n#....##...\n#....#...#\n..##.....#\n......#.#.\n#.....#...\n..........\n#..#....##\n.#.##.#...\n\nTile 1013:\n##.#.#####\n#.####...#\n#..#....#.\n#....##...\n........##\n.#.#.#....\n#..#..##..\n#.#.#.###.\n...##..##.\n##.###...#\n\nTile 3373:\n.##..#.###\n.....#....\n...#..#...\n#...#....#\n#..####..#\n#...#.##.#\n.....##.##\n....#.....\n...##....#\n.#..###...\n\nTile 3041:\n.#..#.####\n..........\n.........#\n..#.....#.\n.....#....\n#..#....#.\n.......#.#\n..#......#\n....#..#..\n..####..##\n\nTile 1627:\n.###.#...#\n...#..#.##\n#...###..#\n..#.......\n##...##...\n#.....####\n##........\n#..#......\n#.##.....#\n...#...#.#\n\nTile 1297:\n#..#...#.#\n#.........\n..#.#..#..\n..#......#\n.#..##...#\n....#..#.#\n#...###...\n#...#....#\n#..#..#..#\n##..#.#..#\n\nTile 1787:\n####.....#\n.....##..#\n..........\n#...#.....\n..........\n..#..#.#..\n#..#..###.\n#......##.\n...##..#..\n##.....###\n\nTile 3109:\n##.###..##\n.#.#......\n.#.......#\n#.........\n#.#..#.#..\n#.#....#..\n#.....#..#\n........##\n##..#....#\n##.###..#.\n\nTile 3541:\n.##.####.#\n.....#.#.#\n#.........\n.#.##...##\n..........\n#.......##\n.#......##\n.....###.#\n##...##...\n.#...#.##.\n\nTile 3347:\n....##.#.#\n..#..#..##\n.#..#.##.#\n....#.....\n....#.....\n#.....##.#\n#....#....\n##....#...\n.#.......#\n####.##.##\n\nTile 1721:\n###.#.##.#\n##..#.....\n#.......#.\n.#..##..#.\n#.##....##\n...#....##\n##...#..#.\n#.#.#.#...\n#.#...#.##\n..########\n\nTile 1847:\n#...##.#.#\n..#...#...\n##........\n.##......#\n........##\n.#.#.#....\n.##.#....#\n#..#......\n.#..#..###\n.#.##..###\n\nTile 3329:\n###......#\n##....#...\n#.........\n##.#.##.##\n#.#.......\n..........\n##......#.\n...#...###\n#...#..##.\n#......#..\n\nTile 3881:\n.#.#..##..\n##..#...#.\n.......#..\n#.#..#...#\n#.#..#..##\n#..##.##.#\n#...#..#.#\n#..#......\n..#...#.#.\n.####..###\n\nTile 1709:\n#####.#.#.\n.#.##..###\n##..##...#\n#####....#\n#..#......\n....#..#..\n#...#.#...\n#...#.#...\n#..#.....#\n#..#.####.\n\nTile 1171:\n...#.#.#.#\n#.....#...\n#..#......\n.......##.\n.....#....\n#...#...#.\n#........#\n#....#....\n..#......#\n...#.#.#..\n\nTile 1499:\n########.#\n#..#.###.#\n...#.###..\n#......#.#\n###......#\n...#......\n#...##.#..\n....#.#..#\n###.#.#...\n####.##..#\n\nTile 1283:\n.##.###.#.\n#.........\n..#..##.##\n....#.....\n#.#.##..#.\n.##...#..#\n#........#\n....#...##\n.....##..#\n#.#.###..#\n\nTile 1637:\n.#.##.###.\n....#.....\n#..##.##..\n.###...##.\n####.....#\n##.....#..\n#.....##..\n#.#.##.#..\n#........#\n#.#.###.#.\n\nTile 3911:\n##.###....\n#.#.##....\n.#...#...#\n.#.#.#...#\n.#.....#..\n##....##..\n#.........\n..#.#.....\n##....#..#\n##..###...\n\nTile 3259:\n...#...#.#\n...#..#..#\n#.#.###...\n#..#...#.#\n#....###.#\n....#.....\n.#....#..#\n#........#\n#....#..##\n##...#.##.\n\nTile 2099:\n##.##..###\n.....#.###\n...##..#.#\n..#.......\n.###.#...#\n..##.#.#..\n#.#.......\n#.##.....#\n...#..###.\n.##..#.#..\n\nTile 1237:\n.##..###..\n###..#....\n#...#.#...\n#......#..\n.....#..#.\n......##..\n#...#.....\n#.........\n.#......##\n...##.##..\n\nTile 1987:\n#..#.#.###\n...#...#..\n#.#....#.#\n..#...#...\n....#..##.\n#........#\n.#.#.#..#.\n#....###.#\n#.#....#.#\n..######.#\n\nTile 2539:\n##.#...#..\n..#..#.##.\n#.....#...\n#...#.#...\n.........#\n#.........\n......#..#\n#......#.#\n......#.#.\n.#..##....\n\nTile 2269:\n#.##.#..##\n#.......##\n.#...#.##.\n.##......#\n.##.##....\n#..#...#..\n.#..#...#.\n###.....#.\n#......###\n...#####.#\n\nTile 1583:\n.##.####.#\n...#....##\n.........#\n.....#...#\n.#...##.##\n#.....#..#\n.#.#.#....\n...#..#.#.\n#..#.#...#\n#.#..#.###\n\nTile 2749:\n.#..#...#.\n....##.###\n##...#....\n#.#..##.##\n#.#..#....\n.#.#..#..#\n#...#..#..\n####..#..#\n#.#.#..#.#\n#..##.##..\n\nTile 1613:\n#.#.#.#..#\n....#.##.#\n....#.....\n.#...###.#\n.###.##..#\n###.#.....\n#.#....#.#\n..#..#...#\n#...#...#.\n#.##.####.\n\nTile 1823:\n...####..#\n#....#...#\n.....##.#.\n....#.#..#\n.#..##..##\n#####.....\n....##....\n#....#...#\n....#.....\n...#.#.#.#\n\nTile 3821:\n.#####.###\n##....##..\n##.#.##..#\n.##...#..#\n.##.....##\n...#..#...\n......#..#\n.....#...#\n.#.####.#.\n..#.#....#\n\nTile 1451:\n#..#..###.\n###...#...\n.......##.\n.#......##\n#.#.......\n...#.....#\n#.........\n##....##..\n#......###\n##...###.#\n\nTile 1913:\n#########.\n#........#\n#.##..#..#\n.###.....#\n##.......#\n###.......\n.....#...#\n#...#.....\n#.##......\n..#.#..###\n\nTile 1307:\n.#.##.#.#.\n#..#..##.#\n#.#...#..#\n...#..#..#\n#...#.....\n#...#....#\n.......##.\n....#.....\n...#.#....\n##.###.#..\n\nTile 1777:\n..#..##..#\n##....#...\n#...#..#..\n.##...#..#\n###.##.#.#\n........##\n.....#....\n##.....#..\n..#..#.#..\n.##..##...\n\nTile 3011:\n#.#..##.#.\n#.....#..#\n.###...#..\n..........\n#.....#...\n...#.#....\n#..#.....#\n...#..##.#\n#......#.#\n...###....\n\nTile 2459:\n#.##.##.##\n.##.#....#\n.....#.#.#\n#.##...#..\n.###.#.#..\n.##.......\n#.#..#....\n.#.....#..\n#.#...#.##\n#.####.###\n\nTile 1123:\n....#...##\n..###.#.#.\n....#.....\n#.#..#..##\n#.#..#..#.\n.#..#.####\n....#.###.\n#..#.....#\n........##\n.####.....\n\nTile 3917:\n##.#.#.###\n.........#\n........#.\n.....#....\n.#.....#.#\n#.....#.#.\n#..#...#..\n#.........\n#........#\n#####..#.#\n\nTile 2287:\n##.##.###.\n##.....###\n..#.....#.\n#.....#.#.\n#..#.#.###\n.#...#...#\n#..###..#.\n#..##.....\n###...#..#\n#..####.##\n\nTile 1471:\n#.##...#..\n.##.#.#..#\n#.......##\n.......###\n....#.#...\n##.......#\n#....#...#\n#....###..\n.##.#.##..\n####.#....\n\nTile 2357:\n####......\n..#.......\n#.#...#..#\n#.........\n..........\n##..#..#..\n.#..###...\n..#..##...\n##....###.\n##...#....\n\nTile 1319:\n###...###.\n..#..#....\n#..#.....#\n......#.##\n.........#\n...#....#.\n###..#...#\n###..##..#\n....##.#..\n#...#.....\n\nTile 3467:\n..#...#...\n.#.....#.#\n..#......#\n..#......#\n#..#....#.\n.#....#.#.\n##..#.....\n###....#..\n#.....##..\n##...#...#\n\nTile 3407:\n.###..####\n#....#...#\n#.........\n..#....#.#\n..#.....##\n.#.....#.#\n..#.#..#..\n#..#.##...\n.#....##..\n.#####.###\n\nTile 2801:\n#..##..##.\n..#.....##\n.....#....\n..#...##..\n#.#....#.#\n#....#.#.#\n..#...#.##\n#.#..##..#\n#...#.#..#\n##.....#.#\n\nTile 1021:\n......#.#.\n...#...#..\n#.#......#\n##..#..#.#\n##..#.....\n..#..#..#.\n......##.#\n......##..\n..##......\n##....#...\n\nTile 3677:\n#.#.......\n#...#.##.#\n....#..#.#\n.#...#....\n..........\n.........#\n..#..#.#.#\n#.#.##...#\n..##.....#\n#.##.##.##\n\nTile 1321:\n.#.#...#.#\n#..##...##\n#.#.....#.\n###.......\n#........#\n.#..#....#\n#.##.##...\n#.#....##.\n.##.....##\n#.#####...\n\nTile 1607:\n....###..#\n..#...#...\n.#.......#\n#...#.....\n...#......\n#.........\n#...#.....\n........##\n##...#...#\n#....#.#.#\n\nTile 1979:\n##.#.#....\n.#..#...##\n#.......#.\n..........\n..#...#...\n.....#...#\n.........#\n...#..###.\n.###......\n#####..#..\n\nTile 2927:\n#.##..###.\n#.#......#\n......#...\n...#....##\n#....##...\n##.......#\n#..#..#...\n....#..#..\n#...#.#..#\n#.###.....\n\nTile 3203:\n#.#..#..#.\n.#.#......\n....##..#.\n....######\n#........#\n..#......#\n##.#...#..\n#......#.#\n#.....#.##\n.##..###.#\n\nTile 3323:\n##..###.#.\n.......#.#\n.........#\n#.........\n........#.\n.........#\n###......#\n..........\n#...#.#..#\n.##.#.###.\n\nTile 1489:\n.#...##.#.\n........##\n.##.#...##\n.......#.#\n#.##.#.#.#\n.##....##.\n#....#..#.\n#..#.....#\n##.#.##.##\n.#.#.#....\n\nTile 2273:\n####.#..#.\n##.#......\n##..###.##\n.##..#....\n#..#.#...#\n##...#....\n#.#...#.#.\n#..#.....#\n##.#..#.#.\n##...#..#.\n\nTile 2293:\n.#.##.#...\n..#.#.#.#.\n.......###\n#.#....#..\n#......#.#\n##..##.#.#\n######..##\n#.....#...\n##....#..#\n#.#####.##\n\nTile 1301:\n#.....##..\n#..#.....#\n#......#.#\n#....#....\n##.#.#..##\n......#...\n#.........\n#........#\n#..#.....#\n###..##...\n\nTile 1229:\n.#..####..\n##.....##.\n##........\n#...#.....\n.#....#.#.\n#.........\n..#......#\n##..##.#.#\n#####....#\n#..#.###..\n\nTile 3769:\n.#..#.##.#\n##.....#.#\n#.#...#..#\n..#..##..#\n#.##.#####\n.....##.#.\n#.#.####..\n.###...#..\n#.#...#..#\n.#.####...\n\nTile 3319:\n######.###\n....#...##\n#..##..#.#\n##.....#..\n#.#.##..#.\n#.#.#.....\n.........#\n#.#.#..###\n....#..#.#\n####....#.\n\nTile 3547:\n##..#..##.\n#.....#...\n.#.......#\n.......#.#\n#.....#..#\n#..##.#.#.\n....#.#...\n....#..#..\n.....#....\n...#.#..##\n\nTile 3643:\n....####.#\n...#......\n.##......#\n#...#.....\n.......##.\n##.......#\n......##.#\n#.....#...\n#.#.......\n######...#\n\nTile 1103:\n#...#.#.#.\n.........#\n.....#....\n.......#..\n#......###\n##......##\n#..#.....#\n#.#.....#.\n#...#...##\n.#.#...#.#\n\nTile 2711:\n###.##.##.\n....#...#.\n##.......#\n#.....#...\n#...#.#.##\n#..##.#...\n..#....###\n...#....##\n.##.#####.\n.##.##.#.#\n\nTile 1871:\n#.###.####\n.........#\n#......#.#\n..##....##\n#..#..##.#\n#..###...#\n#.#.....##\n......#.#.\n.#.#.....#\n#.#.#.....\n\nTile 3851:\n..##.##.#.\n.....#.#..\n#....#...#\n#..#..#..#\n###.....#.\n#.#..#..##\n..#......#\n.##.#....#\n#....##.#.\n.##..#.#.#\n\nTile 1151:\n###......#\n...##.....\n....#.....\n....#.....\n#..#..#...\n##....##..\n..#......#\n.#.....#.#\n........##\n.##.#..#.#\n\nTile 2377:\n.##.##.#.#\n.....##.##\n###.......\n#....##..#\n##......#.\n...#.##..#\n#...#....#\n.##..#.##.\n#.###...#.\n.#.#..##..\n\nTile 3581:\n..#.#....#\n..#.#..#..\n.##..#.##.\n#.##..##..\n#.....#...\n#..#...###\n...#......\n#.#.......\n####......\n#.#...####\n\nTile 1303:\n##.#.#....\n#.#.#.##.#\n..#......#\n.##.##...#\n##..#..#..\n#...#.#.##\n##..#.#..#\n..##.#....\n#.........\n.#.#..##.#\n\nTile 2843:\n##.##..##.\n#..##.##.#\n#...#....#\n#..#.####.\n#...#.....\n##....#..#\n#...#.....\n..#..###..\n#..#..#..#\n##..##...#\n\nTile 3617:\n##...##..#\n.#..#...#.\n.##......#\n#.####...#\n##........\n#.........\n#......#..\n##...#....\n#.##..#..#\n.##..##...\n\nTile 1091:\n######..#.\n....#.#..#\n.....#...#\n#....#...#\n......#.##\n...#.##...\n#...#.....\n..#.###...\n#....#..##\n#.###..#..\n\nTile 1213:\n.##..#.#.#\n.#..#..#..\n##.#.#....\n#....##..#\n##........\n##..#.....\n#...#..#..\n#...#..#..\n#.......#.\n#.....#.##"
  println(findCorners(input))
  println(findSeaMonsters(input))
}

case class Tile(id: BigInt, tile: Array[String]) {
  def borders(): Set[String] = {
    Set(north(), east(), south(), west())
  }

  def north(): String = tile(0)

  def south(): String = tile(tile.length - 1)

  def east(): String = tile.map(str => str.substring(str.length - 1)).mkString

  def west(): String = tile.map(str => str.substring(0, 1)).mkString

  def allBorders(): Set[String] = {
    borders().union(rotate().borders()).union(rotate().rotate().borders()).union(rotate().rotate().rotate().borders())
  }

  def rotate(): Tile = {
    val rotated = new Array[String](tile.length)
    for (i <- 0 until tile(0).length) {
      var str = ""
      for (j <- tile.indices) {
        str = str + tile(tile.length - 1 - j)(i)
      }
      rotated(i) = str
    }
    Tile(id, rotated)
  }

  def flip(): Tile = {
    val flipped = new Array[String](tile.length)
    for (i <- 0 until tile(0).length) {
      flipped(tile.length - 1 - i) = tile(i)
    }
    Tile(id, flipped)
  }

  def removeBorders(): Tile = {
    val newArray = tile.map(str => str.substring(1, str.length - 1)).slice(1, tile.length - 1)
    Tile(id, newArray)
  }

  def concatRow(another: Tile): Tile = {
    val concat = tile.zipWithIndex.map(row => row._1 + another.tile(row._2))
    Tile(0, concat)
  }

  def concatColumn(another: Tile): Tile = {
    val concat = tile ++ another.tile
    Tile(0, concat)
  }
}
